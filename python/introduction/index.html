



<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="复制">
      
        <meta name="lang:clipboard.copied" content="已复制">
      
        <meta name="lang:search.language" content="ja">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="没有找到符合条件的结果">
      
        <meta name="lang:search.result.one" content="找到 1 个符合条件的结果">
      
        <meta name="lang:search.result.other" content="# 个符合条件的结果">
      
        <meta name="lang:search.tokenizer" content="[\uff0c\u3002]+">
      
      <link rel="shortcut icon" href="../..">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-4.4.2">
    
    
      
        <title>课程概述</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.30686662.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="">
      
    
    
      <script src="../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts-gstatic.lug.ustc.edu.cn" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.lug.ustc.edu.cn/css?family=Fira+Sans:300,400,400i,700|Fira+Mono&display=fallback">
        <style>body,input{font-family:"Fira Sans","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Fira Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="white" data-md-color-accent="red">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#_1" tabindex="1" class="md-skip">
        跳转至
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="课程资料" class="md-header-nav__button md-logo">
          
            <i class="md-icon">school</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              课程资料
            </span>
            <span class="md-header-nav__topic">
              
                课程概述
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            键入以开始搜索
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/anjingcuc/courses-wiki/" title="前往 Github 仓库" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    anjingcuc/courses-wiki
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../.." class="md-tabs__link">
        首页
      </a>
    
  </li>

      
        
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="./" class="md-tabs__link md-tabs__link--active">
          Python 程序设计
        </a>
      
    </li>
  

      
        
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../cms/slides/" class="md-tabs__link">
          计算机安全与维护
        </a>
      
    </li>
  

      
        
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../web/homework/" class="md-tabs__link">
          网页设计与制作
        </a>
      
    </li>
  

      
        
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../apdms/introduction/" class="md-tabs__link">
          数字媒体安全应用与实践
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="课程资料" class="md-nav__button md-logo">
      
        <i class="md-icon">school</i>
      
    </a>
    课程资料
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/anjingcuc/courses-wiki/" title="前往 Github 仓库" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    anjingcuc/courses-wiki
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="首页" class="md-nav__link">
      首页
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../" title="Python 程序设计" class="md-nav__link">
      Python 程序设计
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Python 程序设计
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Python 程序设计
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        课程概述
      </label>
    
    <a href="./" title="课程概述" class="md-nav__link md-nav__link--active">
      课程概述
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    小乌龟实例
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    网络爬虫
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#-" class="md-nav__link">
    人工智能-换脸
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../basic/" title="基本概念" class="md-nav__link">
      基本概念
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../data-types-basic/" title="数据类型基础" class="md-nav__link">
      数据类型基础
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../control-flow/" title="程序结构" class="md-nav__link">
      程序结构
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../data-types-advanced/" title="数据类型进阶" class="md-nav__link">
      数据类型进阶
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../io-file/" title="输入输出" class="md-nav__link">
      输入输出
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../file-and-path/" title="文件与目录" class="md-nav__link">
      文件与目录
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../cms/" title="计算机安全与维护" class="md-nav__link">
      计算机安全与维护
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      计算机安全与维护
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        计算机安全与维护
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cms/slides/" title="课件" class="md-nav__link">
      课件
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cms/windows-install-homework/" title="Windows 安装实验" class="md-nav__link">
      Windows 安装实验
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cms/windows-components/" title="Windows 组件实验" class="md-nav__link">
      Windows 组件实验
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cms/malware/" title="恶意代码实验" class="md-nav__link">
      恶意代码实验
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cms/data-recovery-homework/" title="数据恢复实验" class="md-nav__link">
      数据恢复实验
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cms/scripts-homework/" title="脚本实验" class="md-nav__link">
      脚本实验
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../web/" title="网页设计与制作" class="md-nav__link">
      网页设计与制作
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      网页设计与制作
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        网页设计与制作
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../web/homework/" title="作业" class="md-nav__link">
      作业
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../web/introduction/" title="课程概述" class="md-nav__link">
      课程概述
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../web/html-elements/" title="HTML 元素详解" class="md-nav__link">
      HTML 元素详解
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../web/css-first-steps/" title="CSS 样式表" class="md-nav__link">
      CSS 样式表
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../web/css-text/" title="CSS 文本样式" class="md-nav__link">
      CSS 文本样式
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../web/css-box/" title="CSS 盒子样式" class="md-nav__link">
      CSS 盒子样式
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../web/css-layout/" title="CSS 布局" class="md-nav__link">
      CSS 布局
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../web/javascript-introduction/" title="JavaScript 初探" class="md-nav__link">
      JavaScript 初探
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../web/javascript-basic/" title="JavaScript 基础" class="md-nav__link">
      JavaScript 基础
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../web/javascript-blocks/" title="JavaScript 结构化代码" class="md-nav__link">
      JavaScript 结构化代码
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../web/javascript-oo/" title="面向对象的 JavaScript" class="md-nav__link">
      面向对象的 JavaScript
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../web/javascript-API/" title="JavaScript API" class="md-nav__link">
      JavaScript API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../web/bootstrap/" title="Bootstrap" class="md-nav__link">
      Bootstrap
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../web/jQuery/" title="jQuery" class="md-nav__link">
      jQuery
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../apdms/" title="数字媒体安全应用与实践" class="md-nav__link">
      数字媒体安全应用与实践
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      数字媒体安全应用与实践
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        数字媒体安全应用与实践
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../apdms/introduction/" title="课程概述" class="md-nav__link">
      课程概述
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../apdms/flask-intro/" title="Flask 简介" class="md-nav__link">
      Flask 简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../apdms/flask-getting-start/" title="Flask 初探" class="md-nav__link">
      Flask 初探
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../apdms/jinja2/" title="Jinja2 模板" class="md-nav__link">
      Jinja2 模板
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../apdms/wtforms/" title="WTForms 表单" class="md-nav__link">
      WTForms 表单
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    小乌龟实例
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    网络爬虫
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#-" class="md-nav__link">
    人工智能-换脸
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/anjingcuc/courses-wiki/edit/master/docs/python/introduction.md" title="编辑此页" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                  <h1>课程概述</h1>
                
                <p><strong>下方课件区域方向键控制翻页，<code>f</code> 键全屏。</strong></p>
<iframe src="./slideshow.html" frameborder=0 width=800 height=450></iframe>

<h2 id="_1">小乌龟实例</h2>
<p>该实例演示利用 Python 自带的 turtle 模块画图。</p>
<p>其中心型部分参考了 https://www.youtube.com/watch?v=2STVF2vCx2c</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">turtle</span>


<span class="c1"># 画一个弧度</span>
<span class="k">def</span> <span class="nf">curve</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">200</span><span class="p">):</span>
        <span class="n">t</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">t</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>


<span class="c1"># 创建一个空白的窗口</span>
<span class="n">w</span> <span class="o">=</span> <span class="n">turtle</span><span class="o">.</span><span class="n">Screen</span><span class="p">()</span>

<span class="c1"># 创建一只小海龟</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">turtle</span><span class="o">.</span><span class="n">Turtle</span><span class="p">()</span>

<span class="c1"># 不画线，跑到 x=0 y=128 的位置</span>
<span class="n">t</span><span class="o">.</span><span class="n">penup</span><span class="p">()</span>
<span class="n">t</span><span class="o">.</span><span class="n">goto</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">128</span><span class="p">)</span>

<span class="c1"># 落笔，笔的颜色是蓝色，写 anjingcuc</span>
<span class="n">t</span><span class="o">.</span><span class="n">pendown</span><span class="p">()</span>
<span class="n">t</span><span class="o">.</span><span class="n">pencolor</span><span class="p">(</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
<span class="n">t</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;anjingcuc&#39;</span><span class="p">,</span>
        <span class="kc">False</span><span class="p">,</span>
        <span class="n">align</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
        <span class="n">font</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Times New Roman&#39;</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="s1">&#39;normal&#39;</span><span class="p">))</span>

<span class="c1"># 抬起笔，跑到 x=0 y=-50 的位置</span>
<span class="n">t</span><span class="o">.</span><span class="n">penup</span><span class="p">()</span>
<span class="n">t</span><span class="o">.</span><span class="n">goto</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">50</span><span class="p">)</span>

<span class="c1"># 落笔，且线条颜色为红色，填充颜色为红色</span>
<span class="n">t</span><span class="o">.</span><span class="n">pendown</span><span class="p">()</span>
<span class="n">t</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">)</span>

<span class="c1"># 画心型并填充</span>
<span class="n">t</span><span class="o">.</span><span class="n">begin_fill</span><span class="p">()</span>
<span class="n">t</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="mi">140</span><span class="p">)</span>
<span class="n">t</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="mf">111.65</span><span class="p">)</span>
<span class="n">curve</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="n">t</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="mi">120</span><span class="p">)</span>
<span class="n">curve</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="n">t</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="mf">111.65</span><span class="p">)</span>
<span class="n">t</span><span class="o">.</span><span class="n">end_fill</span><span class="p">()</span>

<span class="c1"># 抬笔，并跑到 x=0 y=-148 的位置</span>
<span class="n">t</span><span class="o">.</span><span class="n">penup</span><span class="p">()</span>
<span class="n">t</span><span class="o">.</span><span class="n">goto</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">148</span><span class="p">)</span>

<span class="c1"># 落笔，颜色为绿色</span>
<span class="n">t</span><span class="o">.</span><span class="n">pendown</span><span class="p">()</span>
<span class="n">t</span><span class="o">.</span><span class="n">pencolor</span><span class="p">(</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>

<span class="c1"># 写 bilibili</span>
<span class="n">t</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;bilibili&#39;</span><span class="p">,</span>
        <span class="kc">False</span><span class="p">,</span>
        <span class="n">align</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
        <span class="n">font</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Times New Roman&#39;</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="s1">&#39;normal&#39;</span><span class="p">))</span>

<span class="c1"># 隐藏箭头（即小乌龟）</span>
<span class="n">t</span><span class="o">.</span><span class="n">hideturtle</span><span class="p">()</span>

<span class="c1"># 显示窗口</span>
<span class="n">w</span><span class="o">.</span><span class="n">mainloop</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>

<h2 id="_2">网络爬虫</h2>
<p>批量获取喜欢的图片。</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>

<span class="c1"># 添加 HTTP header 通过修改User-Agent字段伪装成Chrome</span>
<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span>
    <span class="s1">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36&#39;</span>
<span class="p">}</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://www.zhihu.com/question/33797069/answer/961097566&quot;</span><span class="p">,</span>
                 <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>

<span class="c1"># 用 BeautifulSoup 解析返回的 HTML</span>
<span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s1">&#39;html.parser&#39;</span><span class="p">)</span>

<span class="n">images</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;div.RichContent-inner &gt; span &gt; figure &gt; img&#39;</span><span class="p">)</span>

<span class="n">image_number</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">for</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">images</span><span class="p">:</span>
    <span class="n">image_url</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="s1">&#39;data-actualsrc&#39;</span><span class="p">]</span>

    <span class="n">image_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">image_number</span><span class="p">)</span> <span class="o">+</span> <span class="n">Path</span><span class="p">(</span><span class="n">image_url</span><span class="p">)</span><span class="o">.</span><span class="n">suffix</span>

    <span class="c1"># 下载文件</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">image_url</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">image_path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="n">chunk_size</span><span class="o">=</span><span class="mi">512</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">chunk</span><span class="p">:</span>  <span class="c1"># filter out keep-alive new chunks</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="c1"># 有礼貌地间隔5秒获取一个文件</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">image_number</span> <span class="o">+=</span> <span class="mi">1</span>
</code></pre></div>
</td></tr></table>

<h2 id="-">人工智能-换脸</h2>
<p>一键换装？参考 <a href="https://juejin.im/post/5ad60e19f265da239707600d">萌新如何用 Python 实现人脸替换？</a> / <a href="https://github.com/matthewearl/faceswap">matthewearl/faceswap</a> 。</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">cv2</span>
<span class="kn">import</span> <span class="nn">dlib</span>
<span class="kn">import</span> <span class="nn">numpy</span>

<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span>

<span class="n">PREDICTOR_PATH</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span>
                              <span class="s2">&quot;shape_predictor_68_face_landmarks.dat&quot;</span><span class="p">)</span>
<span class="n">SCALE_FACTOR</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">FEATHER_AMOUNT</span> <span class="o">=</span> <span class="mi">11</span>

<span class="c1"># 1-16 脸型</span>
<span class="n">JAW_POINTS</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">17</span><span class="p">))</span>
<span class="c1"># 17-21 右边眉毛</span>
<span class="n">RIGHT_BROW_POINTS</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">22</span><span class="p">))</span>
<span class="c1"># 22-26 左边眉毛</span>
<span class="n">LEFT_BROW_POINTS</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">22</span><span class="p">,</span> <span class="mi">27</span><span class="p">))</span>
<span class="c1"># 27-35 鼻子</span>
<span class="n">NOSE_POINTS</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">27</span><span class="p">,</span> <span class="mi">35</span><span class="p">))</span>
<span class="c1"># 36-41 眼睛</span>
<span class="n">RIGHT_EYE_POINTS</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">36</span><span class="p">,</span> <span class="mi">42</span><span class="p">))</span>
<span class="c1"># 42-47 眼睛</span>
<span class="n">LEFT_EYE_POINTS</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">42</span><span class="p">,</span> <span class="mi">48</span><span class="p">))</span>
<span class="c1"># 48-68 嘴巴</span>
<span class="n">MOUTH_POINTS</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">48</span><span class="p">,</span> <span class="mi">68</span><span class="p">))</span>

<span class="c1"># 17-68 整个脸</span>
<span class="n">FACE_POINTS</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">68</span><span class="p">))</span>
<span class="n">FACE_END</span> <span class="o">=</span> <span class="mi">68</span>
<span class="c1"># Points used to line up the images.</span>
<span class="n">ALIGN_POINTS</span> <span class="o">=</span> <span class="p">(</span><span class="n">LEFT_BROW_POINTS</span> <span class="o">+</span> <span class="n">RIGHT_EYE_POINTS</span> <span class="o">+</span> <span class="n">LEFT_EYE_POINTS</span> <span class="o">+</span>
                <span class="n">RIGHT_BROW_POINTS</span> <span class="o">+</span> <span class="n">NOSE_POINTS</span> <span class="o">+</span> <span class="n">MOUTH_POINTS</span><span class="p">)</span>

<span class="c1"># Points from the second image to overlay on the first. The convex hull of each</span>
<span class="c1"># element will be overlaid.</span>
<span class="n">OVERLAY_POINTS</span> <span class="o">=</span> <span class="p">[</span><span class="n">FACE_POINTS</span><span class="p">]</span>

<span class="c1"># Amount of blur to use during colour correction, as a fraction of the</span>
<span class="c1"># pupillary distance.</span>
<span class="n">COLOUR_CORRECT_BLUR_FRAC</span> <span class="o">=</span> <span class="mf">0.6</span>

<span class="n">detector</span> <span class="o">=</span> <span class="n">dlib</span><span class="o">.</span><span class="n">get_frontal_face_detector</span><span class="p">()</span>
<span class="n">predictor</span> <span class="o">=</span> <span class="n">dlib</span><span class="o">.</span><span class="n">shape_predictor</span><span class="p">(</span><span class="n">PREDICTOR_PATH</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">TooManyFaces</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">NoFaces</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">def</span> <span class="nf">draw_point</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">FILLED</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">LINE_AA</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">rect_contains</span><span class="p">(</span><span class="n">rect</span><span class="p">,</span> <span class="n">point</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">rect</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">elif</span> <span class="n">point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">rect</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">elif</span> <span class="n">point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">rect</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">rect</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">elif</span> <span class="n">point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">rect</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">rect</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span>


<span class="k">def</span> <span class="nf">measure_triangle</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">points</span><span class="p">):</span>
    <span class="n">rect</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">sub_div</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">Subdiv2D</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">points</span><span class="p">:</span>
        <span class="n">sub_div</span><span class="o">.</span><span class="n">insert</span><span class="p">((</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="c1">#sub_div.insert(points)</span>

    <span class="n">triangle_list</span> <span class="o">=</span> <span class="n">sub_div</span><span class="o">.</span><span class="n">getTriangleList</span><span class="p">()</span>

    <span class="n">triangle</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">triangle_list</span><span class="p">:</span>
        <span class="n">pt</span> <span class="o">=</span> <span class="p">[(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span> <span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="mi">5</span><span class="p">])]</span>

        <span class="n">pt1</span> <span class="o">=</span> <span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">pt2</span> <span class="o">=</span> <span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">pt3</span> <span class="o">=</span> <span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">rect_contains</span><span class="p">(</span><span class="n">rect</span><span class="p">,</span> <span class="n">pt1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">rect_contains</span><span class="p">(</span>
                <span class="n">rect</span><span class="p">,</span> <span class="n">pt2</span><span class="p">)</span> <span class="ow">and</span> <span class="n">rect_contains</span><span class="p">(</span><span class="n">rect</span><span class="p">,</span> <span class="n">pt3</span><span class="p">):</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">points</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mf">1.0</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span>
                            <span class="n">pt</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">points</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
                        <span class="n">ind</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">triangle</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ind</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ind</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ind</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>

    <span class="k">return</span> <span class="n">triangle</span>


<span class="k">def</span> <span class="nf">morph_triangle</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">t_src</span><span class="p">,</span> <span class="n">t_dst</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>
    <span class="n">r1</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">boundingRect</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">([</span><span class="n">t_src</span><span class="p">]))</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">boundingRect</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">([</span><span class="n">t_dst</span><span class="p">]))</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">boundingRect</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">([</span><span class="n">t</span><span class="p">]))</span>

    <span class="n">t1_rect</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">t2_rect</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">t_rect</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
        <span class="n">t_rect</span><span class="o">.</span><span class="n">append</span><span class="p">(((</span><span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
        <span class="n">t1_rect</span><span class="o">.</span><span class="n">append</span><span class="p">(((</span><span class="n">t_src</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">r1</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="p">(</span><span class="n">t_src</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">r1</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
        <span class="n">t2_rect</span><span class="o">.</span><span class="n">append</span><span class="p">(((</span><span class="n">t_dst</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">r2</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="p">(</span><span class="n">t_dst</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">r2</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>

    <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">r</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">fillConvexPoly</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">t_rect</span><span class="p">),</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">img1_rect</span> <span class="o">=</span> <span class="n">src</span><span class="p">[</span><span class="n">r1</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span><span class="n">r1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">r1</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">r1</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">r1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">r1</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
    <span class="n">img2_rect</span> <span class="o">=</span> <span class="n">dst</span><span class="p">[</span><span class="n">r2</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span><span class="n">r2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">r2</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">r2</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">r2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">r2</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>

    <span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>

    <span class="n">warp_img1</span> <span class="o">=</span> <span class="n">affine_transform</span><span class="p">(</span><span class="n">img1_rect</span><span class="p">,</span> <span class="n">t1_rect</span><span class="p">,</span> <span class="n">t_rect</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
    <span class="n">warp_img2</span> <span class="o">=</span> <span class="n">affine_transform</span><span class="p">(</span><span class="n">img2_rect</span><span class="p">,</span> <span class="n">t2_rect</span><span class="p">,</span> <span class="n">t_rect</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>

    <span class="n">img_rect</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">warp_img1</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">warp_img2</span>

    <span class="n">img</span><span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">r</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
        <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">r</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">=</span> <span class="n">img</span><span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">r</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span>
                                <span class="n">r</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">mask</span><span class="p">)</span> <span class="o">+</span> <span class="n">img_rect</span> <span class="o">*</span> <span class="n">mask</span>


<span class="k">def</span> <span class="nf">affine_triangle</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">t_src</span><span class="p">,</span> <span class="n">t_dst</span><span class="p">):</span>
    <span class="n">r1</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">boundingRect</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">([</span><span class="n">t_src</span><span class="p">]))</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">boundingRect</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">([</span><span class="n">t_dst</span><span class="p">]))</span>

    <span class="n">t1_rect</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">t2_rect</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">t2_rect_int</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
        <span class="n">t1_rect</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">t_src</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">r1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t_src</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">r1</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">t2_rect</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">t_dst</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">r2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t_dst</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">r2</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">t2_rect_int</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">t_dst</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">r2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t_dst</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">r2</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

    <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">r2</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">r2</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">fillConvexPoly</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">t2_rect_int</span><span class="p">),</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">img1_rect</span> <span class="o">=</span> <span class="n">src</span><span class="p">[</span><span class="n">r1</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span><span class="n">r1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">r1</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">r1</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">r1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">r1</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>

    <span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="n">r2</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">r2</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>

    <span class="n">img2_rect</span> <span class="o">=</span> <span class="n">affine_transform</span><span class="p">(</span><span class="n">img1_rect</span><span class="p">,</span> <span class="n">t1_rect</span><span class="p">,</span> <span class="n">t2_rect</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
    <span class="n">img2_rect</span> <span class="o">=</span> <span class="n">img2_rect</span> <span class="o">*</span> <span class="n">mask</span>

    <span class="n">dst</span><span class="p">[</span><span class="n">r2</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span><span class="n">r2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">r2</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">r2</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">r2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span>
        <span class="n">r2</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">=</span> <span class="n">dst</span><span class="p">[</span><span class="n">r2</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span><span class="n">r2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">r2</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">r2</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">r2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">r2</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">*</span> <span class="p">(</span>
            <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">-</span> <span class="n">mask</span><span class="p">)</span>

    <span class="n">dst</span><span class="p">[</span><span class="n">r2</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span><span class="n">r2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">r2</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">r2</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">r2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span>
        <span class="n">r2</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">=</span> <span class="n">dst</span><span class="p">[</span><span class="n">r2</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span><span class="n">r2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">r2</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">r2</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">r2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">r2</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">+</span> <span class="n">img2_rect</span>


<span class="k">def</span> <span class="nf">affine_transform</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">src_tri</span><span class="p">,</span> <span class="n">dst_tri</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
    <span class="n">warp_mat</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">getAffineTransform</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="n">src_tri</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="n">dst_tri</span><span class="p">))</span>

    <span class="n">dst</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">warpAffine</span><span class="p">(</span><span class="n">src</span><span class="p">,</span>
                         <span class="n">warp_mat</span><span class="p">,</span> <span class="p">(</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                         <span class="kc">None</span><span class="p">,</span>
                         <span class="n">flags</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">INTER_LINEAR</span><span class="p">,</span>
                         <span class="n">borderMode</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">BORDER_REFLECT_101</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">dst</span>


<span class="k">def</span> <span class="nf">get_landmarks</span><span class="p">(</span><span class="n">im</span><span class="p">):</span>
    <span class="n">rects</span> <span class="o">=</span> <span class="n">detector</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rects</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">TooManyFaces</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rects</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">NoFaces</span>

    <span class="c1"># 特征提取器（predictor）要一个粗糙的边界框作为算法输入，由传统的能返回一个矩形列表的人脸检测器（detector）提供，其每个矩形列表在图像中对应一个脸。</span>
    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="n">p</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">y</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">predictor</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">rects</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">parts</span><span class="p">()])</span>


<span class="k">def</span> <span class="nf">draw_convex_hull</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
    <span class="n">points</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">convexHull</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">fillConvexPoly</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>


<span class="c1"># 用普氏分析法（Procrustes Analysis）实现人脸对齐</span>
<span class="k">def</span> <span class="nf">transformation_from_points</span><span class="p">(</span><span class="n">points1</span><span class="p">,</span> <span class="n">points2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return an affine transformation [s * R | T] such that:</span>

<span class="sd">        sum ||s*R*p1,i + T - p2,i||^2</span>

<span class="sd">    is minimized.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Solve the procrustes problem by subtracting centroids, scaling by the</span>
    <span class="c1"># standard deviation, and then using the SVD to calculate the rotation. See</span>
    <span class="c1"># the following for more details:</span>
    <span class="c1">#   https://en.wikipedia.org/wiki/Orthogonal_Procrustes_problem</span>

    <span class="c1"># 1.将2个图片的脸部浮点转换成矩阵</span>
    <span class="n">points1</span> <span class="o">=</span> <span class="n">points1</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="n">points2</span> <span class="o">=</span> <span class="n">points2</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

    <span class="c1"># 2.将每一个点集减去它的矩心。一旦为这两个新的点集找到了一个最佳的缩放和旋转方法，这两个矩心c1和c2就可以用来找到完整的解决方案。</span>
    <span class="n">c1</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">points1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">c2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">points2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">points1</span> <span class="o">-=</span> <span class="n">c1</span>
    <span class="n">points2</span> <span class="o">-=</span> <span class="n">c2</span>

    <span class="c1"># 3.同样，将每一个点集除以它的标准偏差。这消除了缩放偏差。</span>
    <span class="n">s1</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">points1</span><span class="p">)</span>
    <span class="n">s2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">points2</span><span class="p">)</span>
    <span class="n">points1</span> <span class="o">/=</span> <span class="n">s1</span>
    <span class="n">points2</span> <span class="o">/=</span> <span class="n">s2</span>

    <span class="c1"># 4.使用奇异值分解（singular value decomposition）计算旋转部分。请参阅维基百科有关Orthogonal Procrustes Problem的文章，以了解它的具体工作原理。</span>
    <span class="n">U</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">Vt</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">svd</span><span class="p">(</span><span class="n">points1</span><span class="o">.</span><span class="n">T</span> <span class="o">*</span> <span class="n">points2</span><span class="p">)</span>

    <span class="c1"># The R we seek is in fact the transpose of the one given by U * Vt. This</span>
    <span class="c1"># is because the above formulation assumes the matrix goes on the right</span>
    <span class="c1"># (with row vectors) where as our solution requires the matrix to be on the</span>
    <span class="c1"># left (with column vectors).</span>
    <span class="n">R</span> <span class="o">=</span> <span class="p">(</span><span class="n">U</span> <span class="o">*</span> <span class="n">Vt</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

    <span class="c1"># 5.将整个变换过程以仿射变换矩阵形式返回。</span>
    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span>
        <span class="n">numpy</span><span class="o">.</span><span class="n">hstack</span><span class="p">(((</span><span class="n">s2</span> <span class="o">/</span> <span class="n">s1</span><span class="p">)</span> <span class="o">*</span> <span class="n">R</span><span class="p">,</span> <span class="n">c2</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="p">(</span><span class="n">s2</span> <span class="o">/</span> <span class="n">s1</span><span class="p">)</span> <span class="o">*</span> <span class="n">R</span> <span class="o">*</span> <span class="n">c1</span><span class="o">.</span><span class="n">T</span><span class="p">)),</span>
        <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">])</span>
    <span class="p">])</span>


<span class="k">def</span> <span class="nf">read_im_and_landmarks</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">IMREAD_COLOR</span><span class="p">)</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">im</span><span class="p">,</span>
                    <span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">SCALE_FACTOR</span><span class="p">,</span> <span class="n">im</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">SCALE_FACTOR</span><span class="p">))</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">get_landmarks</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">im</span><span class="p">,</span> <span class="n">s</span>


<span class="k">def</span> <span class="nf">warp_im</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">dshape</span><span class="p">):</span>
    <span class="n">output_im</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">dshape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">im</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">warpAffine</span><span class="p">(</span><span class="n">im</span><span class="p">,</span>
                   <span class="n">M</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="p">(</span><span class="n">dshape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dshape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                   <span class="n">dst</span><span class="o">=</span><span class="n">output_im</span><span class="p">,</span>
                   <span class="n">borderMode</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">BORDER_TRANSPARENT</span><span class="p">,</span>
                   <span class="n">flags</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">WARP_INVERSE_MAP</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">output_im</span>


<span class="k">def</span> <span class="nf">get_face_mask</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">landmarks</span><span class="p">):</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">OVERLAY_POINTS</span><span class="p">:</span>
        <span class="n">draw_convex_hull</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">landmarks</span><span class="p">[</span><span class="n">group</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">im</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">im</span><span class="p">,</span> <span class="n">im</span><span class="p">,</span> <span class="n">im</span><span class="p">])</span><span class="o">.</span><span class="n">transpose</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

    <span class="n">im</span> <span class="o">=</span> <span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">GaussianBlur</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="p">(</span><span class="n">FEATHER_AMOUNT</span><span class="p">,</span> <span class="n">FEATHER_AMOUNT</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.0</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">GaussianBlur</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="p">(</span><span class="n">FEATHER_AMOUNT</span><span class="p">,</span> <span class="n">FEATHER_AMOUNT</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">im</span>


<span class="k">def</span> <span class="nf">correct_colours</span><span class="p">(</span><span class="n">im1</span><span class="p">,</span> <span class="n">im2</span><span class="p">,</span> <span class="n">landmarks1</span><span class="p">):</span>
    <span class="n">blur_amount</span> <span class="o">=</span> <span class="n">COLOUR_CORRECT_BLUR_FRAC</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span>
        <span class="n">numpy</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">landmarks1</span><span class="p">[</span><span class="n">LEFT_EYE_POINTS</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-</span>
        <span class="n">numpy</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">landmarks1</span><span class="p">[</span><span class="n">RIGHT_EYE_POINTS</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
    <span class="n">blur_amount</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">blur_amount</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">blur_amount</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">blur_amount</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">im1_blur</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">GaussianBlur</span><span class="p">(</span><span class="n">im1</span><span class="p">,</span> <span class="p">(</span><span class="n">blur_amount</span><span class="p">,</span> <span class="n">blur_amount</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">im2_blur</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">GaussianBlur</span><span class="p">(</span><span class="n">im2</span><span class="p">,</span> <span class="p">(</span><span class="n">blur_amount</span><span class="p">,</span> <span class="n">blur_amount</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Avoid divide-by-zero errors.</span>
    <span class="n">im2_blur</span> <span class="o">+=</span> <span class="p">(</span><span class="mi">128</span> <span class="o">*</span> <span class="p">(</span><span class="n">im2_blur</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">im2_blur</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">im2</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="o">*</span> <span class="n">im1_blur</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="o">/</span>
            <span class="n">im2_blur</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">change_face</span><span class="p">(</span><span class="n">src_img</span><span class="p">,</span> <span class="n">dst_img</span><span class="p">,</span> <span class="n">out_img</span><span class="p">):</span>
    <span class="c1"># 一、将face变形成model的形状</span>
    <span class="c1"># 1.将两张图片转化成numpy数组，并返回一个68 x2元素矩阵，输入图像的每个特征点对应每行的一个x，y坐标。</span>
    <span class="n">model_img</span><span class="p">,</span> <span class="n">model_landmarks</span> <span class="o">=</span> <span class="n">read_im_and_landmarks</span><span class="p">(</span><span class="n">src_img</span><span class="p">)</span>
    <span class="n">face_img</span><span class="p">,</span> <span class="n">face_landmarks</span> <span class="o">=</span> <span class="n">read_im_and_landmarks</span><span class="p">(</span><span class="n">dst_img</span><span class="p">)</span>

    <span class="c1"># 2.用普氏分析法（Procrustes Analysis）实现人脸对齐</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">transformation_from_points</span><span class="p">(</span><span class="n">model_landmarks</span><span class="p">[</span><span class="n">ALIGN_POINTS</span><span class="p">],</span>
                                   <span class="n">face_landmarks</span><span class="p">[</span><span class="n">ALIGN_POINTS</span><span class="p">])</span>

    <span class="n">mask</span> <span class="o">=</span> <span class="n">get_face_mask</span><span class="p">(</span><span class="n">face_img</span><span class="p">,</span> <span class="n">face_landmarks</span><span class="p">)</span>
    <span class="n">warped_mask</span> <span class="o">=</span> <span class="n">warp_im</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">model_img</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">combined_mask</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">max</span><span class="p">(</span>
        <span class="p">[</span><span class="n">get_face_mask</span><span class="p">(</span><span class="n">model_img</span><span class="p">,</span> <span class="n">model_landmarks</span><span class="p">),</span> <span class="n">warped_mask</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">warped_im2</span> <span class="o">=</span> <span class="n">warp_im</span><span class="p">(</span><span class="n">face_img</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">model_img</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">warped_corrected_im2</span> <span class="o">=</span> <span class="n">correct_colours</span><span class="p">(</span><span class="n">model_img</span><span class="p">,</span> <span class="n">warped_im2</span><span class="p">,</span>
                                           <span class="n">model_landmarks</span><span class="p">)</span>

    <span class="n">output_im</span> <span class="o">=</span> <span class="n">model_img</span> <span class="o">*</span> <span class="p">(</span>
        <span class="mf">1.0</span> <span class="o">-</span> <span class="n">combined_mask</span><span class="p">)</span> <span class="o">+</span> <span class="n">warped_corrected_im2</span> <span class="o">*</span> <span class="n">combined_mask</span>

    <span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="n">out_img</span><span class="p">,</span> <span class="n">output_im</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">change_face</span><span class="p">(</span><span class="s1">&#39;target.jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;face.jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;output.jpg&#39;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../" title="Python 程序设计" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  上一页
                </span>
                Python 程序设计
              </span>
            </div>
          </a>
        
        
          <a href="../basic/" title="基本概念" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  下一页
                </span>
                基本概念
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.c648116f.js"></script>
      
        
        
          
          <script src="../../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
              
                <script src="../../assets/javascripts/lunr/tinyseg.js"></script>
              
              
                <script src="../../assets/javascripts/lunr/lunr.ja.js"></script>
              
            
          
          
        
      
      <script>app.initialize({version:"1.1",url:{base:"../.."}})</script>
      
        <script src="../../search/main.js"></script>
      
    
  </body>
</html>